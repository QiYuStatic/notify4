import"./config.9af19bbc.js";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},l=e.parcelRequire143b;null==l&&((l=function(e){if(e in t)return t[e].exports;if(e in a){var l=a[e];delete a[e];var n={id:e,exports:{}};return t[e]=n,l.call(n.exports,n,n.exports),n.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){a[e]=t},e.parcelRequire143b=l);var n,s,i=l("jAw9N"),r=l("ejx16"),o=l("fcdvt"),d=l("dGGwU"),c=l("5iahp");r=l("ejx16");
/**
 * @remix-run/router v1.0.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},p.apply(this,arguments)}(s=n||(n={})).Pop="POP",s.Push="PUSH",s.Replace="REPLACE";function h(e){return void 0===e&&(e={}),g((function(e,t){let{pathname:a,search:l,hash:n}=e.location;return x("",{pathname:a,search:l,hash:n},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"==typeof t?t:m(t)}),null,e)}function u(e){return{usr:e.state,key:e.key}}function x(e,t,a,l){return void 0===a&&(a=null),p({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?_(t):t,{state:a,key:t&&t.key||l||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:a="",hash:l=""}=e;return a&&"?"!==a&&(t+="?"===a.charAt(0)?a:"?"+a),l&&"#"!==l&&(t+="#"===l.charAt(0)?l:"#"+l),t}function _(e){let t={};if(e){let a=e.indexOf("#");a>=0&&(t.hash=e.substr(a),e=e.substr(0,a));let l=e.indexOf("?");l>=0&&(t.search=e.substr(l),e=e.substr(0,l)),e&&(t.pathname=e)}return t}function g(e,t,a,l){void 0===l&&(l={});let{window:s=document.defaultView,v5Compat:i=!1}=l,r=s.history,o=n.Pop,d=null;function c(){o=n.Pop,d&&d({action:o,location:p.location})}let p={get action(){return o},get location(){return e(s,r)},listen(e){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener("popstate",c),d=e,()=>{s.removeEventListener("popstate",c),d=null}},createHref:e=>t(s,e),push:function(e,t){o=n.Push;let l=x(p.location,e,t);a&&a(l,e);let c=u(l),h=p.createHref(l);try{r.pushState(c,"",h)}catch(e){s.location.assign(h)}i&&d&&d({action:o,location:l})},replace:function(e,t){o=n.Replace;let l=x(p.location,e,t);a&&a(l,e);let s=u(l),c=p.createHref(l);r.replaceState(s,"",c),i&&d&&d({action:o,location:l})},go:e=>r.go(e)};return p}var j,y;function f(e,t,a){void 0===a&&(a="/");let l=A(("string"==typeof t?_(t):t).pathname||"/",a);if(null==l)return null;let n=w(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){return e.length===t.length&&e.slice(0,-1).every(((e,a)=>e===t[a]))?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(n);let s=null;for(let e=0;null==s&&e<n.length;++e)s=C(n[e],l);return s}function w(e,t,a,l){return void 0===t&&(t=[]),void 0===a&&(a=[]),void 0===l&&(l=""),e.forEach(((e,n)=>{let s={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};s.relativePath.startsWith("/")&&(U(s.relativePath.startsWith(l),'Absolute route path "'+s.relativePath+'" nested under path "'+l+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(l.length));let i=B([l,s.relativePath]),r=a.concat(s);e.children&&e.children.length>0&&(U(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+i+'".'),w(e.children,t,r,i)),(null!=e.path||e.index)&&t.push({path:i,score:T(i,e.index),routesMeta:r})})),t}(y=j||(j={})).data="data",y.deferred="deferred",y.redirect="redirect",y.error="error";const v=/^:\w+$/,b=e=>"*"===e;function T(e,t){let a=e.split("/"),l=a.length;return a.some(b)&&(l+=-2),t&&(l+=2),a.filter((e=>!b(e))).reduce(((e,t)=>e+(v.test(t)?3:""===t?1:10)),l)}function C(e,t){let{routesMeta:a}=e,l={},n="/",s=[];for(let e=0;e<a.length;++e){let i=a[e],r=e===a.length-1,o="/"===n?t:t.slice(n.length)||"/",d=S({path:i.relativePath,caseSensitive:i.caseSensitive,end:r},o);if(!d)return null;Object.assign(l,d.params);let c=i.route;s.push({params:l,pathname:B([n,d.pathname]),pathnameBase:W(B([n,d.pathnameBase])),route:c}),"/"!==d.pathnameBase&&(n=B([n,d.pathnameBase]))}return s}function S(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[a,l]=function(e,t,a){void 0===t&&(t=!1);void 0===a&&(a=!0);k("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let l=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,((e,t)=>(l.push(t),"([^\\/]+)")));e.endsWith("*")?(l.push("*"),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))");return[new RegExp(n,t?void 0:"i"),l]}(e.path,e.caseSensitive,e.end),n=t.match(a);if(!n)return null;let s=n[0],i=s.replace(/(.)\/+$/,"$1"),r=n.slice(1);return{params:l.reduce(((e,t,a)=>{if("*"===t){let e=r[a]||"";i=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(a){return k(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+a+")."),e}}(r[a]||"",t),e}),{}),pathname:s,pathnameBase:i,pattern:e}}function A(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,l=e.charAt(a);return l&&"/"!==l?null:e.slice(a)||"/"}function U(e,t){if(!1===e||null==e)throw new Error(t)}function k(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(e){}}}function H(e,t,a,l){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the `to."+a+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function L(e,t,a,l){let n;void 0===l&&(l=!1),"string"==typeof e?n=_(e):(n=p({},e),U(!n.pathname||!n.pathname.includes("?"),H("?","pathname","search",n)),U(!n.pathname||!n.pathname.includes("#"),H("#","pathname","hash",n)),U(!n.search||!n.search.includes("#"),H("#","search","hash",n)));let s,i=""===e||""===n.pathname,r=i?"/":n.pathname;if(l||null==r)s=a;else{let e=t.length-1;if(r.startsWith("..")){let t=r.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}s=e>=0?t[e]:"/"}let o=function(e,t){void 0===t&&(t="/");let{pathname:a,search:l="",hash:n=""}="string"==typeof e?_(e):e,s=a?a.startsWith("/")?a:function(e,t){let a=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?a.length>1&&a.pop():"."!==e&&a.push(e)})),a.length>1?a.join("/"):"/"}(a,t):t;return{pathname:s,search:q(l),hash:F(n)}}(n,s),d=r&&"/"!==r&&r.endsWith("/"),c=(i||"."===r)&&a.endsWith("/");return o.pathname.endsWith("/")||!d&&!c||(o.pathname+="/"),o}const B=e=>e.join("/").replace(/\/\/+/g,"/"),W=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),q=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;class R{constructor(e,t,a){this.status=e,this.statusText=t||"",this.data=a}}function E(e){return e instanceof R}r=l("ejx16");function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},P.apply(this,arguments)}const G="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},{useState:D,useEffect:I,useLayoutEffect:M,useDebugValue:N}=r;function $(e){const t=e.getSnapshot,a=e.value;try{const e=t();return!G(a,e)}catch(e){return!0}}const O=!!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?function(e,t,a){return t()}:function(e,t,a){const l=t(),[{inst:n},s]=D({inst:{value:l,getSnapshot:t}});return M((()=>{n.value=l,n.getSnapshot=t,$(n)&&s({inst:n})}),[e,l,t]),I((()=>{$(n)&&s({inst:n});return e((()=>{$(n)&&s({inst:n})}))}),[e]),N(l),l},X=("useSyncExternalStore"in r&&r.useSyncExternalStore,r.createContext(null)),V=r.createContext(null),z=r.createContext(null),J=r.createContext(null),K=r.createContext(null),Y=r.createContext({outlet:null,matches:[]}),Q=r.createContext(null);function Z(){return null!=r.useContext(K)}function ee(){return!Z()&&U(!1),r.useContext(K).location}function te(e){return e.filter(((t,a)=>0===a||!t.route.index&&t.pathnameBase!==e[a-1].pathnameBase))}function ae(){!Z()&&U(!1);let{basename:e,navigator:t}=r.useContext(J),{matches:a}=r.useContext(Y),{pathname:l}=ee(),n=JSON.stringify(te(a).map((e=>e.pathnameBase))),s=r.useRef(!1);return r.useEffect((()=>{s.current=!0})),r.useCallback((function(a,i){if(void 0===i&&(i={}),!s.current)return;if("number"==typeof a)return void t.go(a);let r=L(a,JSON.parse(n),l,"path"===i.relative);"/"!==e&&(r.pathname="/"===r.pathname?e:B([e,r.pathname])),(i.replace?t.replace:t.push)(r,i.state,i)}),[e,t,n,l])}function le(){let e=function(){var e;let t=r.useContext(Q),a=ce(oe.UseRouteError),l=r.useContext(Y),n=l.matches[l.matches.length-1];return t||(!l&&U(!1),!n.route.id&&U(!1),null==(e=a.errors)?void 0:e[n.route.id])}(),t=E(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,l="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:l},s={padding:"2px 4px",backgroundColor:l};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unhandled Thrown Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),a?r.createElement("pre",{style:n},a):null,r.createElement("p",null,"💿 Hey developer 👋"),r.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",r.createElement("code",{style:s},"errorElement")," props on ",r.createElement("code",{style:s},"<Route>")))}class ne extends r.Component{constructor(e){super(e),this.state={location:e.location,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location?{error:e.error,location:e.location}:{error:e.error||t.error,location:t.location}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error?r.createElement(Q.Provider,{value:this.state.error,children:this.props.component}):this.props.children}}function se(e){let{routeContext:t,match:a,children:l}=e,n=r.useContext(X);return n&&a.route.errorElement&&(n._deepestRenderedBoundaryId=a.route.id),r.createElement(Y.Provider,{value:t},l)}function ie(e,t,a){if(void 0===t&&(t=[]),null==e){if(null==a||!a.errors)return null;e=a.matches}let l=e,n=null==a?void 0:a.errors;if(null!=n){let e=l.findIndex((e=>e.route.id&&(null==n?void 0:n[e.route.id])));!(e>=0)&&U(!1),l=l.slice(0,Math.min(l.length,e+1))}return l.reduceRight(((e,s,i)=>{let o=s.route.id?null==n?void 0:n[s.route.id]:null,d=a?s.route.errorElement||r.createElement(le,null):null,c=()=>r.createElement(se,{match:s,routeContext:{outlet:e,matches:t.concat(l.slice(0,i+1))}},o?d:void 0!==s.route.element?s.route.element:e);return a&&(s.route.errorElement||0===i)?r.createElement(ne,{location:a.location,component:d,error:o,children:c()}):c()}),null)}var re,oe,de;function ce(e){let t=r.useContext(z);return!t&&U(!1),t}(re||(re={})).UseRevalidator="useRevalidator",(de=oe||(oe={})).UseLoaderData="useLoaderData",de.UseActionData="useActionData",de.UseRouteError="useRouteError",de.UseNavigation="useNavigation",de.UseRouteLoaderData="useRouteLoaderData",de.UseMatches="useMatches",de.UseRevalidator="useRevalidator";function pe(e){let{to:t,replace:a,state:l,relative:n}=e;!Z()&&U(!1);let s=r.useContext(z),i=ae();return r.useEffect((()=>{s&&"idle"!==s.navigation.state||i(t,{replace:a,state:l,relative:n})})),null}function he(e){U(!1)}function ue(e){let{basename:t="/",children:a=null,location:l,navigationType:s=n.Pop,navigator:i,static:o=!1}=e;Z()&&U(!1);let d=t.replace(/^\/*/,"/"),c=r.useMemo((()=>({basename:d,navigator:i,static:o})),[d,i,o]);"string"==typeof l&&(l=_(l));let{pathname:p="/",search:h="",hash:u="",state:x=null,key:m="default"}=l,g=r.useMemo((()=>{let e=A(p,d);return null==e?null:{pathname:e,search:h,hash:u,state:x,key:m}}),[d,p,h,u,x,m]);return null==g?null:r.createElement(J.Provider,{value:c},r.createElement(K.Provider,{children:a,value:{location:g,navigationType:s}}))}function xe(e){let{children:t,location:a}=e,l=r.useContext(V);return function(e,t){!Z()&&U(!1);let a,l=r.useContext(z),{matches:s}=r.useContext(Y),i=s[s.length-1],o=i?i.params:{},d=(i&&i.pathname,i?i.pathnameBase:"/"),c=(i&&i.route,ee());if(t){var p;let e="string"==typeof t?_(t):t;"/"!==d&&!(null==(p=e.pathname)?void 0:p.startsWith(d))&&U(!1),a=e}else a=c;let h=a.pathname||"/",u=f(e,{pathname:"/"===d?h:h.slice(d.length)||"/"}),x=ie(u&&u.map((e=>Object.assign({},e,{params:Object.assign({},o,e.params),pathname:B([d,e.pathname]),pathnameBase:"/"===e.pathnameBase?d:B([d,e.pathnameBase])}))),s,l||void 0);return t?r.createElement(K.Provider,{value:{location:P({pathname:"/",search:"",hash:"",state:null,key:"default"},a),navigationType:n.Pop}},x):x}(l&&!t?l.router.routes:ge(t),a)}var me,_e;(_e=me||(me={}))[_e.pending=0]="pending",_e[_e.success=1]="success",_e[_e.error=2]="error";new Promise((()=>{}));r.Component;function ge(e,t){void 0===t&&(t=[]);let a=[];return r.Children.forEach(e,((e,l)=>{if(!r.isValidElement(e))return;if(e.type===r.Fragment)return void a.push.apply(a,ge(e.props.children,t));e.type!==he&&U(!1),e.props.index&&e.props.children&&U(!1);let n=[...t,l],s={id:e.props.id||n.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,hasErrorBoundary:null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle};e.props.children&&(s.children=ge(e.props.children,n)),a.push(s)})),a}function je(e){let{basename:t,children:a,window:l}=e,n=r.useRef();null==n.current&&(n.current=h({window:l,v5Compat:!0}));let s=n.current,[i,o]=r.useState({action:s.action,location:s.location});return r.useLayoutEffect((()=>s.listen(o)),[s]),r.createElement(ue,{basename:t,children:a,location:i.location,navigationType:i.action,navigator:s})}var ye,fe,we;(fe=ye||(ye={})).UseScrollRestoration="useScrollRestoration",fe.UseSubmitImpl="useSubmitImpl",fe.UseFetcher="useFetcher",function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(we||(we={}));var ve=l("gC0Hh"),be=l("6pMsr");i=l("jAw9N"),r=l("ejx16"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class Te extends r.Component{static defaultProps={show_text:"加载中..."};constructor(e){super(e),this.state={}}render(){return this.props.loading?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{textAlign:"center",margin:"auto",padding:"2em"},children:[(0,i.jsx)(d.CircularProgress,{size:"5em",variant:"indeterminate"}),(0,i.jsx)(d.Typography,{style:{paddingTop:"1em"},children:this.props.show_text})]})}):(0,i.jsx)(i.Fragment,{})}}var Ce=l("iX1d0");be=l("6pMsr"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),ve=l("gC0Hh"),be=l("6pMsr"),Ce=l("iX1d0");class Se extends r.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){try{this.setState({loading:!0});const e=await Ce.ApiWxMsgList.do_get({path_args:null,query_args:{unique_id:this.props.unique_id},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});this.setState({msg_list:e||[]})}catch(e){console.error({msg:"fetch wx msg",e:e})}finally{this.setState({loading:!1})}}render(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ve.HeaderBlock,{}),(0,i.jsxs)(d.Container,{style:{paddingTop:"35px"},children:[(0,i.jsxs)(d.Breadcrumbs,{children:[(0,i.jsx)(d.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"微信配置"}),(0,i.jsx)(d.Link,{children:this.props.unique_id})]}),(0,i.jsx)(d.Typography,{variant:"h4",align:"center",children:"消息列表"}),(0,i.jsx)(Te,{loading:this.state.loading}),this.tableUI()]})]})}tableUI=()=>{if(0===this.state.msg_list.length)return(0,i.jsx)(d.Alert,{severity:"error",children:"当前没有消息"});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"发送IP"}),(0,i.jsx)(d.TableCell,{children:"消息类型"}),(0,i.jsx)(d.TableCell,{children:"消息内容"}),(0,i.jsx)(d.TableCell,{children:"发送时间"})]})}),(0,i.jsx)(d.TableBody,{children:this.state.msg_list.map(((e,t)=>{return a=t,l=e,(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:l.src_ip}),(0,i.jsx)(d.TableCell,{children:l.msg_type}),(0,i.jsx)(d.TableCell,{style:{maxWidth:"60vw"},children:(0,i.jsx)("pre",{children:l.content})}),(0,i.jsx)(d.TableCell,{children:new Date(l.ctime).toLocaleString()})]},a)});var a,l}))})]})})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class Ae extends r.Component{static defaultProps={title:"确认删除?"};constructor(e){super(e),this.state={},console.log("show dialog props:",e)}render(){return(0,i.jsxs)(d.Dialog,{open:null!==this.props.value,children:[(0,i.jsx)(d.DialogTitle,{id:"alert-dialog-title",children:this.props.title}),(0,i.jsx)(d.DialogContent,{style:{minWidth:"20vw"},children:(0,i.jsx)(d.DialogContentText,{id:"alert-dialog-description",children:this.props.content})}),(0,i.jsxs)(d.DialogActions,{children:[(0,i.jsx)(d.Button,{color:"primary",autoFocus:!0,onClick:async()=>{await this.props.closeHandler()},children:"关闭"}),(0,i.jsx)(d.Button,{color:"secondary",onClick:async()=>{await this.props.confirmHandler(this.props.value)},children:"确认"})]})]})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),c=l("5iahp");class Ue extends r.Component{static defaultProps={};constructor(e){super(e),this.state={i_type:"password"}}render(){return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[this.eyeUI(),(0,i.jsx)("div",{style:{width:"1em"}}),this.txtUI()]})}eyeUI=()=>"password"===this.state.i_type?(0,i.jsx)(c.Visibility,{onClick:()=>{this.setState({i_type:"text"})}}):(0,i.jsx)(c.VisibilityOff,{onClick:()=>{this.setState({i_type:"password"})}});txtUI=()=>"password"===this.state.i_type?(0,i.jsx)(d.Typography,{children:"******"}):(0,i.jsx)(d.Typography,{children:this.props.value})}class ke extends r.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.wx_list;return e&&0!==e.length?(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"唯一标识"}),(0,i.jsx)(d.TableCell,{children:"应用名称"}),(0,i.jsx)(d.TableCell,{children:"公司ID"}),(0,i.jsx)(d.TableCell,{children:"微信令牌"}),(0,i.jsx)(d.TableCell,{children:"AES密钥"}),(0,i.jsx)(d.TableCell,{children:"代理ID"}),(0,i.jsx)(d.TableCell,{children:"密钥"}),(0,i.jsx)(d.TableCell,{children:"操作"})]})}),(0,i.jsx)(d.TableBody,{children:e.map(this.renderRow)})]}):(0,i.jsx)(d.Typography,{align:"center",fontSize:"2em",children:"您没有企业微信的推送配置"})}renderRow=e=>(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(d.Tooltip,{title:"查看详情",children:(0,i.jsx)(d.Link,{onClick:async()=>{await this.props.showWxAppDetailHandler(e)},children:e.unique_id})})}),(0,i.jsx)(d.TableCell,{children:e.app_name}),(0,i.jsx)(d.TableCell,{children:e.corp_id}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(Ue,{value:e.wx_token})}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(Ue,{value:e.aes_key})}),(0,i.jsx)(d.TableCell,{children:e.agent_id}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(Ue,{value:e.secret})}),(0,i.jsx)(d.TableCell,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Tooltip,{title:"删除这个推送配置?",placement:"top",children:(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.deleteWxAppHandler(e)},children:"删除"})}),(0,i.jsx)(d.Button,{variant:"outlined",onClick:async()=>{await this.props.showWxMsgListHandler(e.unique_id)},children:"查看信息"})]})})]},e.unique_id)}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class He extends r.Component{constructor(e){super(e),this.state={copied:!1}}render(){if(null===this.props.value)return(0,i.jsx)(i.Fragment,{});let e=null;return e=this.state.copied?"已复制":"点击复制",(0,i.jsx)(d.TextField,{value:this.props.value,label:this.props.label,variant:"filled",helperText:this.props.helperText,fullWidth:!0,InputProps:{readOnly:!0,"aria-readonly":!0,endAdornment:(0,i.jsx)(d.InputAdornment,{position:"end",children:(0,i.jsx)(d.Button,{variant:"contained",onClick:async()=>{await navigator.clipboard.writeText(this.props.value),this.setState({copied:!0})},children:e})})}})}}class Le{static buildUrlWithPath(e){return`${document.location.protocol}//${document.location.host}${e}`}}class Be extends r.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.wx_app?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.wxCbUrl(),label:"微信验证URL",helperText:"微信验证回调的URL链接"})}),(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.textNotifyUrl(),label:"文本通知URL",helperText:"接收文本通知的URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.mdNotifyUrl(),label:"markdown通知URL",helperText:"接收markdown通知的URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.chatwootWebookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}wxCbUrl=()=>{const e=this.props.wx_app?.unique_id;return Le.buildUrlWithPath(`/api/wx/verify/${e}`)};chatwootWebookUrl=()=>{const e=this.props.wx_app?.unique_id;return Le.buildUrlWithPath(`/api/wx/chatwoot/${e}`)};textNotifyUrl=()=>{const e=this.props.wx_app?.unique_id;return Le.buildUrlWithPath(`/api/wx/notify/${e}`)};mdNotifyUrl=()=>{const e=this.props.wx_app?.unique_id;return Le.buildUrlWithPath(`/api/wx/md/${e}`)}}class We extends r.Component{constructor(e){super(e),this.state={wx_list:[],loading:!0,secret_type:"password",show_msg_unique:null,delete_wx_app:null,show_app_detail:null}}async componentDidMount(){await this.reloadWxList()}render(){return this.state.show_msg_unique?(0,i.jsx)(Se,{unique_id:this.state.show_msg_unique,onCloseHandler:async()=>{this.setState({show_msg_unique:null})}}):this.state.show_app_detail?(0,i.jsx)(Be,{wx_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Te,{loading:this.state.loading}),(0,i.jsx)(ke,{wx_list:this.state.wx_list,showWxAppDetailHandler:async e=>{this.setState({show_app_detail:e})},showWxMsgListHandler:async e=>{this.setState({show_msg_unique:e})},deleteWxAppHandler:async e=>{this.setState({delete_wx_app:e}),console.log("set delete unique id:",e.unique_id)}}),(0,i.jsx)(Ae,{closeHandler:async()=>{this.setState({delete_wx_app:null})},confirmHandler:async e=>{await this.doDeleteWx(e.unique_id),this.setState({delete_wx_app:null})},value:this.state.delete_wx_app,content:`您确认删除: ${this.state.delete_wx_app?.app_name}?`})]})}reloadWxList=async()=>{try{this.setState({loading:!0});const e=await Ce.ApiWxAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});e&&this.setState({wx_list:e})}catch(e){console.error(e)}finally{this.setState({loading:!1})}};doDeleteWx=async e=>{this.setState({delete_wx_app:null}),await Ce.ApiWxApp.do_delete({path_args:null,query_args:{unique_id:e},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}},(async e=>(console.log({resp:e}),await this.reloadWxList(),{})),(async e=>(console.error({resp:e,text:await e.text()}),alert("删除失败"),{})))}}i=l("jAw9N"),r=l("ejx16"),i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16"),c=l("5iahp");class qe extends r.Component{static defaultProps={};constructor(e){super(e),this.state={}}render(){return this.props.value?(0,i.jsx)(c.Check,{color:"primary"}):(0,i.jsx)(c.Clear,{color:"secondary"})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ce=l("iX1d0");class Fe extends r.Component{constructor(e){super(e),this.state={verify_code:"",verify_failed:!1}}render(){return null===this.props.email_app?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Dialog,{open:!0,children:[(0,i.jsxs)(d.DialogTitle,{children:["邮箱验证:",this.props.email_app.notify_email]}),(0,i.jsxs)(d.DialogContent,{children:[this.failedUI(),(0,i.jsx)(d.DialogContentText,{children:"请在下方输入您接收到的验证码:"}),(0,i.jsx)(d.TextField,{value:this.state.verify_code,autoFocus:!0,margin:"dense",label:"验证码:",type:"text",fullWidth:!0,onChange:e=>{this.setState({verify_code:e.target.value})}})]}),(0,i.jsxs)(d.DialogActions,{children:[(0,i.jsx)(d.Button,{variant:"outlined",color:"primary",autoFocus:!0,onClick:async()=>{await this.doVerifyEmail()},children:"验证"}),(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"关闭"})]})]})})}failedUI=()=>!1===this.state.verify_failed?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Alert,{severity:"error",children:"验证失败, 请确保您输入的验证码有效!"});doVerifyEmail=async()=>{await Ce.ApiEmailAppVerify.do_post({body:{unique_id:this.props.email_app.unique_id,code:this.state.verify_code}},(async e=>(console.log({resp:e}),this.setState({verify_failed:!1}),await this.props.closeHandle(),{})),(async e=>(console.error({resp:e,text:await e.text()}),this.setState({verify_failed:!0}),{})))}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ce=l("iX1d0"),be=l("6pMsr");class Re extends r.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){try{this.setState({loading:!0});const e=await Ce.ApiEmailMsgList.do_get({path_args:null,query_args:{unique_id:this.props.email_unique_id},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}})||[];this.setState({msg_list:e})}finally{this.setState({loading:!1})}}render(){return null===this.props.email_unique_id?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Container,{style:{paddingTop:"35px"},children:[(0,i.jsxs)(d.Breadcrumbs,{children:[(0,i.jsx)(d.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"邮箱配置"}),(0,i.jsx)(d.Link,{children:this.props.email_address})]}),(0,i.jsx)(d.Typography,{variant:"h4",align:"center",children:"消息列表"}),(0,i.jsx)(Te,{loading:this.state.loading}),this.tableUI()]})})}tableUI=()=>{if(0===this.state.msg_list.length)return(0,i.jsx)(d.Alert,{severity:"error",children:"当前没有消息"});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"发送IP"}),(0,i.jsx)(d.TableCell,{children:"消息类型"}),(0,i.jsx)(d.TableCell,{children:"消息内容"}),(0,i.jsx)(d.TableCell,{children:"发送时间"})]})}),(0,i.jsx)(d.TableBody,{children:this.state.msg_list.map(((e,t)=>{return a=t,l=e,(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:l.src_ip}),(0,i.jsx)(d.TableCell,{children:l.msg_type}),(0,i.jsx)(d.TableCell,{style:{maxWidth:"60vw"},children:(0,i.jsx)("pre",{children:l.content})}),(0,i.jsx)(d.TableCell,{children:new Date(l.ctime).toLocaleString()})]},a)});var a,l}))})]})})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class Ee extends r.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.email_app?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.notifyUrl(),label:"通知URL",helperText:"通知URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.chatwootWebookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}chatwootWebookUrl=()=>{const e=this.props.email_app?.unique_id;return Le.buildUrlWithPath(`/api/email/chatwoot/${e}`)};notifyUrl=()=>{const e=this.props.email_app?.unique_id;return Le.buildUrlWithPath(`/api/email/notify/${e}`)}}class Pe extends r.Component{constructor(e){super(e),this.state={email_list:[],loading:!1,show_verify_email:null,show_email_msg_unique_id:null,show_email_msg_email:null,show_delete_dialog:null,selected_delete_email:null,show_app_detail:null}}async componentDidMount(){await this.reloadEmailList()}render(){return this.state.show_email_msg_unique_id?(0,i.jsx)(Re,{email_unique_id:this.state.show_email_msg_unique_id,email_address:this.state.show_email_msg_email,onCloseHandler:async()=>{this.setState({show_email_msg_email:null,show_email_msg_unique_id:null})}}):this.state.show_app_detail?(0,i.jsx)(Ee,{email_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Te,{loading:this.state.loading}),this.tableUI(),(0,i.jsx)(Fe,{email_app:this.state.show_verify_email,closeHandle:async()=>{await this.reloadEmailList(),this.setState({show_verify_email:null})}})]})}reloadEmailList=async()=>{try{this.setState({loading:!0});const e=await Ce.ApiEmailAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});this.setState({email_list:e})}catch(e){throw e}finally{this.setState({loading:!1})}};resendBtn=(e,t)=>e?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Button,{variant:"outlined",onClick:async()=>{await Ce.ApiEmailApp.do_put({path_args:{},query_args:{email:t},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}},(async()=>(alert("发送验证码成功"),{})),(async()=>(alert("发送验证码失败"),{})))},children:"重发验证码"});verifyBtn=(e,t)=>e?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Button,{variant:"outlined",onClick:async()=>{this.setState({show_verify_email:t})},children:"验证"});viewBtn=(e,t,a)=>e?(0,i.jsx)(d.Button,{variant:"outlined",onClick:()=>{this.setState({show_email_msg_unique_id:t,show_email_msg_email:a})},children:"查看信息"}):(0,i.jsx)(i.Fragment,{});renderRow=e=>(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(d.Tooltip,{title:"查看详情",children:(0,i.jsx)(d.Link,{onClick:async()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),(0,i.jsx)(d.TableCell,{children:e.notify_email}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(qe,{value:e.verified})}),(0,i.jsx)(d.TableCell,{children:new Date(e.ctime).toLocaleString()}),(0,i.jsx)(d.TableCell,{children:(0,i.jsxs)(d.ButtonGroup,{children:[this.verifyBtn(e.verified,e),this.resendBtn(e.verified,e.notify_email),(0,i.jsx)(d.Tooltip,{title:"删除此配置?",placement:"top",children:(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:()=>{this.setState({show_delete_dialog:e.unique_id,selected_delete_email:e.notify_email})},children:"删除"})}),this.viewBtn(e.verified,e.unique_id,e.notify_email)]})})]},e.unique_id);tableUI=()=>{const e=this.state.email_list;return e&&0!==e.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"唯一标识"}),(0,i.jsx)(d.TableCell,{children:"电子邮箱"}),(0,i.jsx)(d.TableCell,{children:"已验证"}),(0,i.jsx)(d.TableCell,{children:"创建时间"}),(0,i.jsx)(d.TableCell,{children:"操作"})]})}),(0,i.jsx)(d.TableBody,{children:this.state.email_list.map(this.renderRow)})]}),(0,i.jsx)(Ae,{content:`确认删除 ${this.state.selected_delete_email} 的配置?`,closeHandler:async()=>{this.setState({show_delete_dialog:null,selected_delete_email:null})},value:this.state.show_delete_dialog,confirmHandler:async e=>{console.log("confirm delete:",e),await Ce.ApiEmailApp.do_delete({path_args:null,query_args:{unique_id:this.state.show_delete_dialog},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}},(async()=>(this.setState({show_delete_dialog:null}),await this.reloadEmailList(),{})),(async()=>(alert("删除配置失败"),{})))}})]}):(0,i.jsx)(d.Typography,{align:"center",fontSize:"2em",children:"您没有电子邮箱的推送配置"})}}class Ge extends r.Component{constructor(e){super(e),this.state={}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(Pe,{})})}}i=l("jAw9N"),r=l("ejx16"),i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class De extends r.Component{constructor(e){super(e),this.state={}}render(){return(0,i.jsxs)(d.ButtonGroup,{children:[this.viewBtn(),this.doVerifyBtn(),this.deleteBtn()]})}viewBtn=()=>this.props.app_info.verified?(0,i.jsx)(d.Button,{onClick:async()=>{await this.props.viewMsgHandler(this.props.app_info)},children:"查看消息"}):(0,i.jsx)(i.Fragment,{});doVerifyBtn=()=>this.props.app_info.verified?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Button,{onClick:async()=>{await this.props.showVerifyHandler(this.props.app_info)},children:"去验证"});deleteBtn=()=>(0,i.jsx)(d.Tooltip,{title:"删除这个推送配置",placement:"top",children:(0,i.jsx)(d.Button,{color:"secondary",onClick:async()=>{await this.props.tryDeleteHandler(this.props.app_info)},children:"删除"})})}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ce=l("iX1d0");class Ie extends r.Component{constructor(e){super(e),this.state={verify_code:"",verify_failed:!1}}render(){const e=this.props.dd_app;return null===e?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Dialog,{open:!0,children:[(0,i.jsxs)(d.DialogTitle,{children:["钉钉验证:",e.app_name]}),(0,i.jsxs)(d.DialogContent,{children:[this.failedUI(),(0,i.jsx)(d.DialogContentText,{children:"请在下方输入您接收到的验证码:"}),(0,i.jsx)(d.TextField,{value:this.state.verify_code,autoFocus:!0,margin:"dense",label:"验证码:",type:"text",fullWidth:!0,onChange:e=>{this.setState({verify_code:e.target.value})}})]}),(0,i.jsxs)(d.DialogActions,{children:[(0,i.jsx)(d.Button,{variant:"outlined",color:"primary",autoFocus:!0,onClick:async()=>{await this.doVerify()},children:"验证"}),(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{this.setState({verify_failed:!1}),await this.props.closeHandle(!1)},children:"关闭"})]})]})})}failedUI=()=>!1===this.state.verify_failed?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Alert,{severity:"error",children:"验证失败, 请确保您输入的验证码有效!"});doVerify=async()=>{const e=this.props.dd_app;await Ce.ApiDdAppVerify.do_post({body:{unique_id:e.unique_id,code:this.state.verify_code}},(async()=>(this.setState({verify_failed:!1}),await this.props.closeHandle(!0),{})),(async()=>(this.setState({verify_failed:!0}),{})))}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ce=l("iX1d0"),be=l("6pMsr");class Me extends r.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){const e=this.props.dd_app;if(null!==e)try{this.setState({loading:!0});const t=await Ce.ApiDdMsgList.do_get({path_args:null,query_args:{unique_id:e.unique_id},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}})||[];this.setState({msg_list:t})}finally{this.setState({loading:!1})}}render(){const e=this.props.dd_app;return null===e?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Container,{style:{paddingTop:"35px"},children:[(0,i.jsxs)(d.Breadcrumbs,{children:[(0,i.jsx)(d.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"钉钉配置"}),(0,i.jsx)(d.Link,{children:e.app_name})]}),(0,i.jsx)(d.Typography,{variant:"h4",align:"center",children:"消息列表"}),(0,i.jsx)(Te,{loading:this.state.loading}),this.tableUI()]})})}tableUI=()=>{if(0===this.state.msg_list.length)return(0,i.jsx)(d.Alert,{severity:"error",children:"当前没有消息"});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"发送IP"}),(0,i.jsx)(d.TableCell,{children:"消息类型"}),(0,i.jsx)(d.TableCell,{children:"消息内容"}),(0,i.jsx)(d.TableCell,{children:"发送时间"})]})}),(0,i.jsx)(d.TableBody,{children:this.state.msg_list.map(((e,t)=>{return a=t,l=e,(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:l.src_ip}),(0,i.jsx)(d.TableCell,{children:l.msg_type}),(0,i.jsx)(d.TableCell,{style:{maxWidth:"60vw"},children:(0,i.jsx)("pre",{children:l.content})}),(0,i.jsx)(d.TableCell,{children:new Date(l.ctime).toLocaleString()})]},a)});var a,l}))})]})})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class Ne extends r.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.dd_app?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.notifyUrl(),label:"通知URL",helperText:"通知 URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.chatwootWebHookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}chatwootWebHookUrl=()=>{const e=this.props.dd_app?.unique_id;return Le.buildUrlWithPath(`/api/dd/chatwoot/${e}`)};notifyUrl=()=>{const e=this.props.dd_app?.unique_id;return Le.buildUrlWithPath(`/api/dd/notify/${e}`)}}class $e extends r.Component{constructor(e){super(e),this.state={dd_app_list:[],loading:!1,show_app_delete:null,show_msg_list:null,show_app_verify:null,show_app_detail:null}}async componentDidMount(){await this.reloadAppList()}render(){return this.state.show_msg_list?(0,i.jsx)(Me,{dd_app:this.state.show_msg_list,onCloseHandler:async()=>{this.setState({show_msg_list:null})}}):this.state.show_app_detail?(0,i.jsx)(Ne,{dd_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Te,{loading:this.state.loading}),this.tableUI(),(0,i.jsx)(Ie,{dd_app:this.state.show_app_verify,closeHandle:async e=>{this.setState({show_app_verify:null}),e&&await this.reloadAppList()}})]})}renderRow=e=>(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(d.Tooltip,{title:"查看详情",children:(0,i.jsx)(d.Link,{onClick:async()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),(0,i.jsx)(d.TableCell,{children:e.app_name}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(qe,{value:e.verified})}),(0,i.jsxs)(d.TableCell,{children:[(0,i.jsx)(Ue,{value:e.dd_ak})," "]}),(0,i.jsxs)(d.TableCell,{children:[(0,i.jsx)(Ue,{value:e.dd_sk})," "]}),(0,i.jsx)(d.TableCell,{children:new Date(e.ctime).toLocaleString()}),(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(De,{app_info:e,viewMsgHandler:async e=>{this.setState({show_msg_list:e})},showVerifyHandler:async e=>{this.setState({show_app_verify:e})},tryDeleteHandler:async e=>{this.setState({show_app_delete:e})}})})]},e.unique_id);tableUI=()=>{const e=this.state.dd_app_list;return e&&0!==e.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"唯一标识"}),(0,i.jsx)(d.TableCell,{children:"应用名称"}),(0,i.jsx)(d.TableCell,{children:"已验证"}),(0,i.jsx)(d.TableCell,{children:"访问令牌"}),(0,i.jsx)(d.TableCell,{children:"加密密钥"}),(0,i.jsx)(d.TableCell,{children:"创建时间"}),(0,i.jsx)(d.TableCell,{children:"操作"})]})}),(0,i.jsx)(d.TableBody,{children:e.map(this.renderRow)})]}),(0,i.jsx)(Ae,{content:`确认删除 ${this.state.show_app_delete?.app_name} 的推送配置?`,closeHandler:async()=>{this.setState({show_app_delete:null})},value:this.state.show_app_delete,confirmHandler:async e=>{await Ce.ApiDdApp.do_delete({query_args:{unique_id:e.unique_id},security:{bearer:be.UserLogic.getBearerToken()}},(async()=>(this.setState({show_app_delete:null}),await this.reloadAppList(),{})),(async()=>(alert("删除配置失败"),{})))}})]}):(0,i.jsx)(d.Typography,{align:"center",fontSize:"2em",children:"您没有钉钉的推送配置"})};reloadAppList=async()=>{try{this.setState({loading:!0});const e=await Ce.ApiDdAppList.do_get({security:{bearer:be.UserLogic.getBearerToken()}})||[];this.setState({dd_app_list:e})}finally{this.setState({loading:!1})}}}class Oe extends r.Component{constructor(e){super(e),this.state={}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)($e,{})})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16");class Xe extends r.Component{static defaultProps={width:"auto",height:"auto"};constructor(e){super(e),this.state={}}render(){return(0,i.jsx)("div",{style:{width:this.props.width,height:this.props.height}})}}var Ve=l("acJjt");be=l("6pMsr"),Ce=l("iX1d0");class ze extends r.Component{constructor(e){super(e),this.state={app_name:"",dd_ak:"",dd_sk:""}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{width:"80%",margin:"auto"},children:[(0,i.jsx)(Xe,{height:"1em"}),(0,i.jsxs)("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"钉钉访问令牌",variant:"outlined",value:this.state.dd_ak,helperText:"钉钉机器人的 WebHook 或者 AccessToken",fullWidth:!0,onChange:e=>{try{const t=new URL(e.target.value).searchParams.get("access_token");t?this.setState({dd_ak:t}):this.setState({dd_ak:e.target.value})}catch(t){this.setState({dd_ak:e.target.value})}}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"签名密钥",variant:"outlined",value:this.state.dd_sk,helperText:"钉钉签名密钥配置",fullWidth:!0,onChange:e=>{this.setState({dd_sk:e.target.value})}})}),(0,i.jsx)(Ve.HCenterHelper,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",size:"large",onClick:async()=>{await Ce.ApiDdApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:be.UserLogic.getBearerToken()}},(async()=>(await this.props.closeHandle(),{})),(async()=>(alert("添加失败"),{})))},children:"保存"}),(0,i.jsx)(d.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ve=l("acJjt"),Ce=l("iX1d0"),be=l("6pMsr");class Je extends r.Component{constructor(e){super(e),this.state={email:""}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{width:"80%",margin:"auto"},children:[(0,i.jsx)(Xe,{height:"1em"}),(0,i.jsxs)("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.email,label:"电子邮箱",variant:"outlined",helperText:"接收推送通知的电子邮箱",fullWidth:!0,onChange:e=>{this.setState({email:e.target.value})}})}),(0,i.jsx)(Ve.HCenterHelper,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",size:"large",onClick:async()=>{await this.saveEmailApp()},children:"保存"}),(0,i.jsx)(d.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}saveEmailApp=async()=>{await Ce.ApiEmailApp.do_put({path_args:null,query_args:{email:this.state.email},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}},(async e=>(console.log({resp:e}),await this.props.closeHandle(),{})),(async e=>(console.log({text:await e.text(),resp:e}),alert("添加邮箱失败"),{})))}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ve=l("acJjt"),be=l("6pMsr"),Ce=l("iX1d0");class Ke extends r.Component{constructor(e){super(e),this.state={app_name:"",corp_id:"",wx_token:"",aes_key:"",agent_id:0,secret:""}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{width:"80%",margin:"auto"},children:[(0,i.jsx)(Xe,{height:"1em"}),(0,i.jsxs)("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的应用名称",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.corp_id,label:"企业微信公司ID",variant:"outlined",helperText:"企业微信公司的ID, 我的企业 -> 企业信息 -> 企业ID",fullWidth:!0,onChange:e=>{this.setState({corp_id:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"企业微信令牌",variant:"outlined",value:this.state.wx_token,helperText:"企业微信 -> 应用 -> API接收消息 -> token",fullWidth:!0,onChange:e=>{this.setState({wx_token:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"AES密钥",variant:"outlined",value:this.state.aes_key,helperText:"企业微信 -> 应用 -> API接收消息 -> EncodeAESKey",fullWidth:!0,onChange:e=>{this.setState({aes_key:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"AgentID",variant:"outlined",value:this.state.agent_id.toString(),type:"number",fullWidth:!0,helperText:"企业微信 -> 应用 -> AgentId",onChange:e=>{this.setState({agent_id:parseInt(e.target.value)})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"Secret",variant:"outlined",value:this.state.secret,fullWidth:!0,helperText:"企业微信 -> 应用 -> Secret",onChange:e=>{this.setState({secret:e.target.value})}})}),(0,i.jsx)(Ve.HCenterHelper,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",size:"large",onClick:async()=>{await Ce.ApiWxApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:be.UserLogic.getBearerToken()}})?(alert("成功"),await this.props.closeHandle()):alert("添加失败")},children:"保存"}),(0,i.jsx)(d.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class Ye extends r.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.tpl_app;return null===e?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(He,{value:this.webhookUrl(),label:"通知URL",helperText:"接收通知的URL"})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:e.app_name,label:"应用名称",variant:"filled",helperText:"这个应用的名字",fullWidth:!0})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:e.tpl_code,label:"模版代码",variant:"filled",multiline:!0,helperText:"模版的代码",fullWidth:!0})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:e.comment,label:"备注",variant:"filled",helperText:"这个应用的备注",multiline:!0,fullWidth:!0})}),(0,i.jsx)("div",{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.onCloseHandler()},children:"关闭"}),(0,i.jsx)(d.Button,{variant:"outlined",onClick:async()=>{await this.props.onEditHandler(this.props.tpl_app)},children:"编辑"})]})})]})}webhookUrl=()=>{const e=this.props.tpl_app?.unique_id;return`${document.location.protocol}//${document.location.host}/api/tpl/notify/${e}`}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ve=l("acJjt"),be=l("6pMsr"),Ce=l("iX1d0"),i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),d=l("dGGwU");class Qe extends r.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadWxList()}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Autocomplete,{renderInput:e=>(0,i.jsx)(d.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.app_name===t&&await this.props.onSelectHandler(e)})))}})})}reloadWxList=async()=>{try{this.setState({app_loading:!0});const e=await Ce.ApiWxAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.app_name))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),d=l("dGGwU");class Ze extends r.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadDdList()}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Autocomplete,{renderInput:e=>(0,i.jsx)(d.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.app_name===t&&await this.props.onSelectHandler(e)})))}})})}reloadDdList=async()=>{try{this.setState({app_loading:!0});const e=await Ce.ApiDdAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.app_name))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=l("jAw9N"),r=l("ejx16"),Ce=l("iX1d0"),be=l("6pMsr"),d=l("dGGwU");class et extends r.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadEmailList()}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Autocomplete,{renderInput:e=>(0,i.jsx)(d.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.notify_email===t&&await this.props.onSelectHandler(e)})))}})})}reloadEmailList=async()=>{try{this.setState({app_loading:!0});const e=await Ce.ApiEmailAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.notify_email))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU");class tt extends r.Component{constructor(e){super(e),this.state={tpl_list:[],tpl_loading:!0,ac_list:[]}}async componentDidMount(){try{this.setState({tpl_loading:!0});const e=await fetch("/static/notify_tpl/builtin.json"),t=await e.json();this.setState({tpl_list:t,ac_list:t.map((e=>e.name))})}catch(e){console.error(e)}finally{this.setState({tpl_loading:!1})}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.Autocomplete,{renderInput:e=>(0,i.jsx)(d.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{await Promise.all(this.state.tpl_list.map((async e=>{if(e.name===t){const t=await this.loadTplCodeByFile(e.file);await this.props.onSelectTplCode(t)}})))}})})}loadTplCodeByFile=async e=>{const t=await fetch(`/static/notify_tpl/${e}`);return t.ok?await t.text():(console.log("get tpl code error: ",t),"")}}class at extends r.Component{constructor(e){super(e),this.state={unique_id:"",app_name:"",wx_app:null,dd_app:null,email_app:null,tpl_code:"",comment:"",cur_wx_app_name:null,cur_dd_app_name:null,cur_email_app_name:null}}async componentDidMount(){const e=await Ce.ApiTplApp.do_get({path_args:null,query_args:{unique_id:this.props.unique_id},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});this.setState({unique_id:e.unique_id,app_name:e.app_name,wx_app:e.wx_app?.unique_id,dd_app:e.dd_app?.unique_id,email_app:e.email_app?.unique_id,tpl_code:e.tpl_code,comment:e.comment,cur_wx_app_name:e.wx_app?.app_name,cur_dd_app_name:e.dd_app?.app_name,cur_email_app_name:e.email_app?.notify_email})}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{width:"80%",margin:"auto"},children:[(0,i.jsx)(Xe,{height:"1em"}),(0,i.jsxs)("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(tt,{label:"内置模版选择",fullWidth:!0,helperText:"您可以从内置的模版中选择您所需要的模版代码",onSelectTplCode:async e=>{this.setState({tpl_code:e})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"模版代码",multiline:!0,value:this.state.tpl_code,helperText:"这个通知使用的 Jinja2 模版",fullWidth:!0,onChange:e=>{this.setState({tpl_code:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"应用备注",multiline:!0,value:this.state.comment,helperText:"这个应用的备注",fullWidth:!0,onChange:e=>{this.setState({comment:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(Qe,{label:"企业微信APP",fullWidth:!0,helperText:"选择需要接收这个通知的企业微信 APP",onSelectHandler:async e=>{this.setState({wx_app:e?.unique_id})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(Ze,{label:"钉钉APP",fullWidth:!0,helperText:"选择需要接收这个通知的钉钉 APP",onSelectHandler:async e=>{this.setState({dd_app:e?.unique_id})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(et,{label:"邮箱通知",fullWidth:!0,helperText:"选择需要接收这个通知的电子邮箱",onSelectHandler:async e=>{this.setState({email_app:e?.unique_id})}})}),(0,i.jsx)(Ve.HCenterHelper,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",size:"large",onClick:async()=>{await Ce.ApiTplApp.do_patch({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:be.UserLogic.getBearerToken()}},(async e=>(await this.props.closeHandle(),await e.json())),(async()=>(alert("更新失败"),{})))},children:"更新"}),(0,i.jsx)(d.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}class lt extends r.Component{constructor(e){super(e),this.state={show_app_detail:null,show_app_update:null}}render(){if(this.state.show_app_detail)return(0,i.jsx)(Ye,{tpl_app:this.state.show_app_detail,onEditHandler:async e=>{this.setState({show_app_detail:null,show_app_update:e})},onCloseHandler:async()=>{this.setState({show_app_detail:null})}});if(this.state.show_app_update)return(0,i.jsx)(at,{unique_id:this.state.show_app_update?.unique_id,closeHandle:async()=>{this.setState({show_app_update:null}),await this.props.reloadingHandler()}});const e=this.props.tpl_app_list;return e&&0!==e.length?(0,i.jsxs)(d.Table,{children:[(0,i.jsx)(d.TableHead,{children:(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:"唯一标识"}),(0,i.jsx)(d.TableCell,{children:"应用名称"}),(0,i.jsx)(d.TableCell,{children:"企业微信"}),(0,i.jsx)(d.TableCell,{children:"电子邮箱"}),(0,i.jsx)(d.TableCell,{children:"钉钉"}),(0,i.jsx)(d.TableCell,{children:"创建时间"}),(0,i.jsx)(d.TableCell,{children:"操作"})]})}),(0,i.jsx)(d.TableBody,{children:e.map(this.renderRow)})]}):(0,i.jsx)(d.Typography,{align:"center",fontSize:"2em",children:"您没有自定义模版推送配置"})}renderRow=e=>(0,i.jsxs)(d.TableRow,{children:[(0,i.jsx)(d.TableCell,{children:(0,i.jsx)(d.Tooltip,{title:"查看详情",children:(0,i.jsx)(d.Link,{onClick:()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),(0,i.jsx)(d.TableCell,{children:e.app_name}),(0,i.jsx)(d.TableCell,{children:e.wx_app?.app_name}),(0,i.jsx)(d.TableCell,{children:e.email_app?.notify_email}),(0,i.jsx)(d.TableCell,{children:e.dd_app?.app_name}),(0,i.jsx)(d.TableCell,{children:new Date(e.ctime).toLocaleString()}),(0,i.jsx)(d.TableCell,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",onClick:async()=>{this.setState({show_app_update:e})},children:"更新"}),(0,i.jsx)(d.Tooltip,{title:"删除此配置?",placement:"top",children:(0,i.jsx)(d.Button,{color:"secondary",variant:"outlined",onClick:async()=>{await this.props.onDeleteHandler(e)},children:"删除"})})]})})]},e.unique_id)}class nt extends r.Component{constructor(e){super(e),this.state={tpl_app_list:[],tpl_app_loading:!1,tpl_delete_app:null}}async componentDidMount(){await this.fetchTplAppList()}render(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Te,{loading:this.state.tpl_app_loading}),(0,i.jsx)(lt,{tpl_app_list:this.state.tpl_app_list,reloadingHandler:this.fetchTplAppList,onDeleteHandler:async e=>{this.setState({tpl_delete_app:e})}}),(0,i.jsx)(Ae,{content:`确认删除: ${this.state.tpl_delete_app?.app_name}?`,closeHandler:async()=>{this.setState({tpl_delete_app:null})},value:this.state.tpl_delete_app,confirmHandler:async e=>{await Ce.ApiTplApp.do_delete({path_args:null,query_args:{unique_id:e.unique_id},header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}},(async()=>(this.setState({tpl_delete_app:null}),await this.fetchTplAppList(),{})),(async()=>{alert(`删除: ${this.state.tpl_delete_app?.app_name} 失败!`)}))}})]})}fetchTplAppList=async()=>{try{this.setState({tpl_app_loading:!0});const e=await Ce.ApiTplAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:be.UserLogic.getBearerToken()}});this.setState({tpl_app_list:e})}catch(e){console.error("fetch tpl app list:",e)}finally{this.setState({tpl_app_loading:!1})}}}i=l("jAw9N"),r=l("ejx16"),d=l("dGGwU"),Ve=l("acJjt"),be=l("6pMsr"),Ce=l("iX1d0");class st extends r.Component{constructor(e){super(e),this.state={app_name:"",wx_app:null,dd_app:null,email_app:null,tpl_code:"",comment:""}}render(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{width:"80%",margin:"auto"},children:[(0,i.jsx)(Xe,{height:"1em"}),(0,i.jsxs)("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(tt,{label:"内置模版选择",fullWidth:!0,helperText:"您可以从内置的模版中选择您所需要的模版代码",onSelectTplCode:async e=>{this.setState({tpl_code:e})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"模版代码",multiline:!0,value:this.state.tpl_code,helperText:"这个通知使用的 Jinja2 模版",fullWidth:!0,onChange:e=>{this.setState({tpl_code:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.TextField,{label:"应用备注",multiline:!0,value:this.state.comment,helperText:"这个应用的备注",fullWidth:!0,onChange:e=>{this.setState({comment:e.target.value})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(Qe,{label:"企业微信APP",fullWidth:!0,helperText:"选择需要接收这个通知的企业微信 APP",onSelectHandler:async e=>{this.setState({wx_app:e?e.unique_id:null})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(Ze,{label:"钉钉APP",fullWidth:!0,helperText:"选择需要接收这个通知的钉钉 APP",onSelectHandler:async e=>{this.setState({dd_app:e?e.unique_id:null})}})}),(0,i.jsx)("div",{children:(0,i.jsx)(et,{label:"邮箱通知",fullWidth:!0,helperText:"选择需要接收这个通知的电子邮箱",onSelectHandler:async e=>{console.log(e),this.setState({email_app:e?e.unique_id:null})}})}),(0,i.jsx)(Ve.HCenterHelper,{children:(0,i.jsxs)(d.ButtonGroup,{children:[(0,i.jsx)(d.Button,{variant:"outlined",size:"large",onClick:async()=>{await Ce.ApiTplApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:be.UserLogic.getBearerToken()}},(async e=>(await this.props.closeHandle(),await e.json())),(async()=>(alert("添加失败"),{})))},children:"保存"}),(0,i.jsx)(d.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}var it,rt=l("fMI85");!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(it||(it={}));function ot(e){e.preventDefault(),e.returnValue=""}function dt(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function ct(){return Math.random().toString(36).substr(2,8)}function pt(e){var t=e.pathname,a=void 0===t?"/":t,l=e.search,n=void 0===l?"":l,s=e.hash,i=void 0===s?"":s;return n&&"?"!==n&&(a+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(a+="#"===i.charAt(0)?i:"#"+i),a}function ht(e){var t={};if(e){var a=e.indexOf("#");a>=0&&(t.hash=e.substr(a),e=e.substr(0,a));var l=e.indexOf("?");l>=0&&(t.search=e.substr(l),e=e.substr(0,l)),e&&(t.pathname=e)}return t}const ut=function(e){void 0===e&&(e={});var t=e.window,a=void 0===t?document.defaultView:t,l=a.history;function n(){var e=a.location,t=e.pathname,n=e.search,s=e.hash,i=l.state||{};return[i.idx,{pathname:t,search:n,hash:s,state:i.usr||null,key:i.key||"default"}]}var s=null;a.addEventListener("popstate",(function(){if(s)p.call(s),s=null;else{var e=it.Pop,t=n(),a=t[0],l=t[1];if(p.length){if(null!=a){var i=o-a;i&&(s={action:e,location:l,retry:function(){g(-1*i)}},g(i))}}else _(e)}}));var i=it.Pop,r=n(),o=r[0],d=r[1],c=dt(),p=dt();function h(e){return"string"==typeof e?e:pt(e)}function u(e,t){return void 0===t&&(t=null),(0,rt.default)({pathname:d.pathname,hash:"",search:""},"string"==typeof e?ht(e):e,{state:t,key:ct()})}function x(e,t){return[{usr:e.state,key:e.key,idx:t},h(e)]}function m(e,t,a){return!p.length||(p.call({action:e,location:t,retry:a}),!1)}function _(e){i=e;var t=n();o=t[0],d=t[1],c.call({action:i,location:d})}function g(e){l.go(e)}null==o&&(o=0,l.replaceState((0,rt.default)({},l.state,{idx:o}),""));var j={get action(){return i},get location(){return d},createHref:h,push:function e(t,n){var s=it.Push,i=u(t,n);if(m(s,i,(function(){e(t,n)}))){var r=x(i,o+1),d=r[0],c=r[1];try{l.pushState(d,"",c)}catch(e){a.location.assign(c)}_(s)}},replace:function e(t,a){var n=it.Replace,s=u(t,a);if(m(n,s,(function(){e(t,a)}))){var i=x(s,o),r=i[0],d=i[1];l.replaceState(r,"",d),_(n)}},go:g,back:function(){g(-1)},forward:function(){g(1)},listen:function(e){return c.push(e)},block:function(e){var t=p.push(e);return 1===p.length&&a.addEventListener("beforeunload",ot),function(){t(),p.length||a.removeEventListener("beforeunload",ot)}}};return j}();class xt extends r.Component{constructor(e){super(e),this.state={}}async componentDidMount(){await be.UserLogic.doSyncIfNeeded()}render(){const e=document.location.pathname.split("/")[2]??"email";return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(je,{children:[(0,i.jsx)(ve.HeaderBlock,{}),(0,i.jsxs)(d.Tabs,{value:e,centered:!0,style:{paddingTop:"70px"},onChange:(e,t)=>{ut.push(`/config/${t}`),this.forceUpdate()},children:[(0,i.jsx)(d.Tab,{label:"电子邮箱",value:"email"}),(0,i.jsx)(d.Tab,{label:"企业微信",value:"wx"}),(0,i.jsx)(d.Tab,{label:"钉钉",value:"dd"}),(0,i.jsx)(d.Tab,{label:"自定义",value:"tpl"})]}),(0,i.jsxs)(xe,{children:[(0,i.jsx)(he,{path:"/config",element:(0,i.jsx)(pe,{replace:!0,to:"/config/email"})}),(0,i.jsx)(he,{path:"/config/email",element:(0,i.jsx)(Ge,{})}),(0,i.jsx)(he,{path:"/config/email/add",element:(0,i.jsx)(Je,{closeHandle:this.closeAddHandler})}),(0,i.jsx)(he,{path:"/config/dd",element:(0,i.jsx)(Oe,{})}),(0,i.jsx)(he,{path:"/config/dd/add",element:(0,i.jsx)(ze,{closeHandle:this.closeAddHandler})}),(0,i.jsx)(he,{path:"/config/wx",element:(0,i.jsx)(We,{})}),(0,i.jsx)(he,{path:"/config/wx/add",element:(0,i.jsx)(Ke,{closeHandle:this.closeAddHandler})}),(0,i.jsx)(he,{path:"/config/tpl",element:(0,i.jsx)(nt,{})}),(0,i.jsx)(he,{path:"/config/tpl/add",element:(0,i.jsx)(st,{closeHandle:this.closeAddHandler})})]}),this.fabAddButton()]})})}closeAddHandler=async()=>{const e=document.location.pathname.split("/");ut.push(`/${e[1]}/${e[2]}`),this.forceUpdate()};fabAddButton=()=>document.location.pathname.endsWith("add")?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(d.Fab,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:"2em",right:"2em"},onClick:()=>{ut.push(`${document.location.pathname}/add`),this.forceUpdate()},children:(0,i.jsx)(c.Add,{})})}o.render((0,i.jsx)(xt,{}),document.querySelector("#react-root"));export{xt as ConfigComponent};